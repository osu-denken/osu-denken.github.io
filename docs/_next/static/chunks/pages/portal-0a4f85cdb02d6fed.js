(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{3646:e=>{e.exports={container:"Page_container__4TqKj",main:"Page_main__MOW5Q",bold:"Page_bold__FOjUO",code:"Page_code__gdauj",grid:"Page_grid__YvlVv",card:"Page_card__qrbpT",description:"Page_description__F5wod",title:"Page_title__XbhM_"}},6299:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/portal",function(){return a(7695)}])},7695:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var n=a(7876),o=a(3646),s=a.n(o),r=a(9455),l=a.n(r),i=a(4232),c=a(8230),d=a.n(c);let h=()=>{let[e,t]=(0,i.useState)("main"),[a,o]=(0,i.useState)(""),[r,c]=(0,i.useState)(null),[h,u]=(0,i.useState)(null),[p,m]=(0,i.useState)("Unknown"),[_,g]=(0,i.useState)(""),[j,x]=(0,i.useState)([]),[b,f]=(0,i.useState)(!1),[v,w]=(0,i.useState)(""),[N,S]=(0,i.useState)(!1);async function P(e,t){try{let a=await fetch("https://api.osudenken4dev.workers.dev/user/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("idToken"))},body:JSON.stringify({[e]:t})}),n=await a.json();if(n.success)return console.log("".concat(e," updated successfully.")),!0;return console.error("Failed to update ".concat(e,".")),console.log(n),!1}catch(e){return console.error("Error:",e),!1}}return(0,i.useEffect)(()=>{if(!N)return;let t=new URLSearchParams(window.location.search);t.set("tab",e);let a="".concat(window.location.pathname,"?").concat(t.toString());window.history.replaceState({},"",a)},[e]),(0,i.useEffect)(()=>{u(localStorage),fetch("https://api.osudenken4dev.workers.dev/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("idToken"))}}).then(e=>e.json()).then(e=>{console.log(e),e.user&&e.user.error&&"INVALID_ID_TOKEN"===e.user.error.message&&(alert("セッションの有効期限が切れました。再度ログインしてください。"),window.location.href="/?i=portal/#login"),e.success||401!==e.status||(alert("セッションの有効期限が切れました。再度ログインしてください。"),window.location.href="/?i=portal/#login"),c(e),g(e.user.email||"")})},[]),(0,i.useEffect)(()=>{localStorage.getItem("idToken")||(window.location.href="/?i=portal/#login");let e=localStorage.getItem("displayName");e&&m(e);let a=new URLSearchParams(window.location.search),n=a.get("msg");n&&o(n);let s=a.get("tab");s&&t(s),S(!0),fetch("https://api.osudenken4dev.workers.dev/discord/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("idToken"))}}).then(e=>e.json()).then(e=>{e.success&&w(e.code)}).catch(e=>{console.error("Failed to discord invite url:",e)})},[]),(0,i.useEffect)(()=>{"blog"!==e||b||fetch("https://api.osudenken4dev.workers.dev/v2/blog/list",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{x(null!=e?e:[]),f(!0)}).catch(e=>{console.error("Failed to load blog list:",e)})},[e]),(0,n.jsx)("div",{className:s().container,children:(0,n.jsxs)("main",{className:s().main,children:[a?(0,n.jsx)("div",{className:l().notice,children:a}):"",(0,n.jsxs)("div",{className:l().tabContainer,children:[(0,n.jsx)("button",{className:"".concat(l().tabButton," ").concat("main"===e?l().active:""),onClick:()=>t("main"),children:"ポータル"}),(0,n.jsx)("button",{className:"".concat(l().tabButton," ").concat("settings"===e?l().active:""),onClick:()=>t("settings"),children:"設定"}),(0,n.jsx)("button",{className:"".concat(l().tabButton," ").concat("blog"===e?l().active:""),onClick:()=>t("blog"),children:"ブログ"})]}),(0,n.jsxs)("div",{className:l().tabContent,children:["main"===e&&(0,n.jsxs)("div",{className:l().tabPane,children:[(0,n.jsxs)("h1",{id:"title",children:["ようこそ、",p," さん"]}),(0,n.jsxs)("p",{className:s().description,children:[(0,n.jsx)(d(),{href:v,children:"Discordへ参加する"}),(0,n.jsx)("br",{}),(0,n.jsx)(d(),{href:"/portal/invite/",children:"招待コードの作成"}),(0,n.jsx)("br",{}),(0,n.jsx)(d(),{href:"/portal/members/",children:"構成員名簿"})]})]}),"settings"===e&&(0,n.jsxs)("div",{className:l().tabPane,children:[(0,n.jsx)("h1",{children:"ユーザー設定"}),(0,n.jsx)("h2",{children:"ユーザー名"}),(0,n.jsxs)("p",{className:s().description,children:["デフォルトでは学籍番号が設定されています。",(0,n.jsx)("br",{}),"変更する場合は以下の入力欄に新しいユーザー名を入力し、更新ボタンを押してください。"]}),(0,n.jsx)("form",{children:(0,n.jsxs)("div",{className:l().inputGroup,children:[(0,n.jsx)("input",{type:"text",id:"usernameInput",placeholder:"ユーザー名",value:p,onChange:e=>m(e.target.value),className:l().portal}),(0,n.jsx)("button",{onClick:e=>{e.preventDefault();let t=document.getElementById("usernameInput").value.trim();t?P("displayName",t).then(e=>{e?(o("ユーザー名を更新しました。"),localStorage.setItem("displayName",t)):(console.log(e),alert("ユーザー名の更新に失敗しました。"))}):alert("有効なユーザー名を入力してください。")},className:l().portal,children:"更新"})]})}),(0,n.jsx)("br",{}),(0,n.jsx)("h2",{children:"パスワードの再設定"}),(0,n.jsxs)("p",{className:s().description,children:["パスワードを再設定するには",(0,n.jsx)(d(),{href:"/resetpass/",children:"こちら"}),"からメールアドレスを入力してください。"]})]}),"blog"===e&&(0,n.jsxs)("div",{className:l().tabPane,children:[(0,n.jsx)("h1",{children:"ブログ"}),(0,n.jsx)("p",{className:s().description}),(0,n.jsx)("form",{children:(0,n.jsxs)("div",{className:l().inputGroup,children:[(0,n.jsx)("input",{type:"text",name:"page",placeholder:"ファイル名",className:l().portal,defaultValue:new Date().toISOString().split("T")[0]+"-"+(new Date().getHours()+new Date().getMinutes()+new Date().getSeconds()),required:!0}),(0,n.jsx)("button",{type:"button",className:l().portal,onClick:()=>{let e=document.querySelector('input[name="page"]').value.trim();if(!e)return void o("ファイル名を入力してください。");let t=encodeURIComponent(e);window.location.href="/portal/blog/?action=edit&page=".concat(t)},children:"新規作成"})]})}),(0,n.jsx)("div",{className:l().grid,children:j.map(e=>(0,n.jsx)(d(),{href:"/portal/blog/?action=edit&page="+e.name,children:(0,n.jsxs)("div",{className:l().card,children:[(0,n.jsx)("h3",{children:e.meta.title?e.meta.title.slice(1,-1):e.name}),(0,n.jsx)("p",{children:e.meta?new Date(e.meta.date).toLocaleDateString():"-"})]})},e.sha))})]})]})]})})}},9455:e=>{e.exports={tabContainer:"Portal_tabContainer__VrhzM",tabButton:"Portal_tabButton__GgWUH",active:"Portal_active__zVMzA",tabContent:"Portal_tabContent__j21tP",portal:"Portal_portal__UHmCy",inputGroup:"Portal_inputGroup__kOtrD",notice:"Portal_notice__fvfef",grid:"Portal_grid__MBxHh",card:"Portal_card__QB5cC"}}},e=>{e.O(0,[636,593,792],()=>e(e.s=6299)),_N_E=e.O()}]);